# WireMock Java Integration

Auto-generated Java WireMock configurations from OpenAPI specifications.

**Generated on:** 2025-09-11 11:39:36

## APIs Included
- open_api: open-api-spec.yaml
- products: products-api.yaml
- users: users-api.yaml

## Quick Start

### 1. Add Dependencies

**Maven:**
```xml
<dependency>
    <groupId>com.github.tomakehurst</groupId>
    <artifactId>wiremock-jre8</artifactId>
    <version>3.3.1</version>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-test</artifactId>
    <scope>test</scope>
</dependency>
```

**Gradle:**
```gradle
testImplementation 'com.github.tomakehurst:wiremock-jre8:3.3.1'
testImplementation 'org.springframework.boot:spring-boot-starter-test'
```

### 2. Use in Tests

**Option 1: Single API**
```java
@SpringBootTest
@Import(ProductsWireMockConfig.class)
class ProductServiceTest {
    @Autowired
    private String productsApiBaseUrl;
    
    @Test
    void shouldCallProductsApi() {
        // Your test here
    }
}
```

**Option 2: Multiple APIs**
```java
@SpringBootTest
@Import(WireMockTestConfig.class)
class IntegrationTest extends BaseWireMockIntegrationTest {
    @Test
    void shouldTestMultipleApis() {
        String productsUrl = getProductsBaseUrl();
        String usersUrl = getUsersBaseUrl();
        // Test API interactions
    }
}
```

**Option 3: Manual Configuration**
```java
class ManualTest {
    private MultiApiWireMockServer server = new MultiApiWireMockServer();
    
    @BeforeEach
    void setUp() {
        server.startAllServers();
    }
    
    @AfterEach
    void tearDown() {
        server.stopAllServers();
    }
}
```

## Generated Classes

### Core Classes
- `MultiApiWireMockServer` - Main orchestrator for all APIs
- `WireMockTestConfig` - Spring Boot configuration for all APIs
- `BaseWireMockIntegrationTest` - Base test class for integration tests

### Per-API Classes
Each API gets:
- `<ApiName>WireMockConfig` - Spring configuration for single API
- `<ApiName>WireMockTest` - Base test class for API-specific tests

## Configuration

### Default Ports
- Base port: 8080
- Each API gets: basePort + index (8080, 8081, 8082, etc.)

### WireMock Files
Place your generated WireMock files in:
```
src/test/resources/wiremock/
├── products/
│   ├── mappings/
│   └── __files/
├── users/
│   ├── mappings/
│   └── __files/
```

## Advanced Usage

### Custom Stubs
```java
@Test
void testWithCustomStub() {
    WireMockServer server = getMultiApiServer().getServer("products");
    
    server.stubFor(get(urlEqualTo("/custom"))
        .willReturn(aResponse()
            .withStatus(200)
            .withBody("custom response")));
}
```

### Dynamic Configuration
```java
@Test
void testWithDynamicConfig() {
    Map<String, String> urls = getMultiApiServer().getServerUrls();
    urls.forEach((api, url) -> {
        // Configure your HTTP clients
        configureClient(api, url);
    });
}
```

### Health Checks
```java
@Test
void allServersHealthy() {
    getMultiApiServer().getServerUrls().forEach((api, url) -> {
        boolean isRunning = getMultiApiServer().isRunning(api);
        assertThat(isRunning).isTrue();
    });
}
```

## Troubleshooting

### Common Issues

**Port conflicts:**
```java
// Check if ports are available
server.getServerUrls().forEach((api, url) -> 
    System.out.println(api + " running on: " + url));
```

**Missing mapping files:**
```
Ensure mapping files are in src/test/resources/wiremock/<api_name>/mappings/
```

**Spring context issues:**
```java
// Make sure to import the configuration
@Import(WireMockTestConfig.class)
```

## Integration Examples

### RestTemplate
```java
@Test
void testWithRestTemplate() {
    RestTemplate restTemplate = new RestTemplate();
    String url = getProductsBaseUrl() + "/products";
    
    ResponseEntity<String> response = restTemplate.getForEntity(url, String.class);
    assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);
}
```

### WebTestClient
```java
@Test
void testWithWebTestClient() {
    WebTestClient client = WebTestClient.bindToServer()
        .baseUrl(getUsersBaseUrl())
        .build();
        
    client.get().uri("/users")
        .exchange()
        .expectStatus().isOk();
}
```

---

**Generated by Multi-Spec WireMock Mapping Generator**
